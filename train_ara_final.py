import json
import os
import time
from openai import OpenAI

# ==========================================
# 1. ì„¤ì • (ì—¬ê¸°ì— API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”!)
# ==========================================
import os
API_KEY = os.environ.get("OPENAI_API_KEY")
client = OpenAI(api_key=API_KEY)

# ==========================================
# 2. í•™ìŠµ ë°ì´í„° ë³µêµ¬ ë° ìƒì„± (JSONL)
# ==========================================
print("ğŸ”„ [1/3] ARA í•™ìŠµ ë°ì´í„°ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...")

# í•™ìš°ë‹˜ì´ ë³´ë‚´ì£¼ì…¨ë˜ í•µì‹¬ ìë£Œ ê¸°ë°˜ ë°ì´í„° (ë³µêµ¬ë¨)
training_data = [
    # 2026í•™ë…„ë„ í•™ì‚¬ì¼ì •
    {"messages": [{"role": "system", "content": "ë‹¹ì‹ ì€ í•œêµ­í•´ì–‘ëŒ€ ì¬í•™ìƒ ë¹„ì„œ ARAì…ë‹ˆë‹¤."}, {"role": "user", "content": "2026í•™ë…„ë„ ì…í•™ì‹ ì–¸ì œì•¼?"}, {"role": "assistant", "content": "í•™ìš°ë‹˜, 2026í•™ë…„ë„ ì…í•™ì‹ì€ 2ì›” 26ì¼(ëª©)ì…ë‹ˆë‹¤."}]},
    {"messages": [{"role": "system", "content": "ë‹¹ì‹ ì€ í•œêµ­í•´ì–‘ëŒ€ ì¬í•™ìƒ ë¹„ì„œ ARAì…ë‹ˆë‹¤."}, {"role": "user", "content": "2026ë…„ 1í•™ê¸° ê°œê°•ì¼ ì•Œë ¤ì¤˜."}, {"role": "assistant", "content": "í•™ìš°ë‹˜, 1í•™ê¸° ê°œê°•ì¼ì€ 3ì›” 3ì¼(í™”)ì…ë‹ˆë‹¤."}]},
    {"messages": [{"role": "system", "content": "ë‹¹ì‹ ì€ í•œêµ­í•´ì–‘ëŒ€ ì¬í•™ìƒ ë¹„ì„œ ARAì…ë‹ˆë‹¤."}, {"role": "user", "content": "26ë…„ë„ ì¤‘ê°„ê³ ì‚¬ëŠ” ì–¸ì œ?"}, {"role": "assistant", "content": "í•™ìš°ë‹˜, 1í•™ê¸° ì¤‘ê°„ê³ ì‚¬ëŠ” 4ì›” 21ì¼(í™”)ë¶€í„° 4ì›” 27ì¼(ì›”)ê¹Œì§€ì…ë‹ˆë‹¤."}]},
    
    # í•™ì¹™ ë° ê°€ì´ë“œ
    {"messages": [{"role": "system", "content": "ë‹¹ì‹ ì€ í•œêµ­í•´ì–‘ëŒ€ ì¬í•™ìƒ ë¹„ì„œ ARAì…ë‹ˆë‹¤."}, {"role": "user", "content": "í•™ì‚¬ê²½ê³  ê¸°ì¤€ì´ ë­ì•¼?"}, {"role": "assistant", "content": "í•™ìš°ë‹˜, ë§¤ í•™ê¸° í‰ì í‰ê· ì´ 1.75 ë¯¸ë§Œì¸ ê²½ìš° í•™ì‚¬ê²½ê³ ë¥¼ ë°›ê²Œ ë©ë‹ˆë‹¤. í•™ì—… ê´€ë¦¬ì— ìœ ì˜í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤."}]},
    {"messages": [{"role": "system", "content": "ë‹¹ì‹ ì€ í•œêµ­í•´ì–‘ëŒ€ ì¬í•™ìƒ ë¹„ì„œ ARAì…ë‹ˆë‹¤."}, {"role": "user", "content": "ì¡¸ì—…ì¸ì¦ì œ ì™¸êµ­ì–´ ë©´ì œ ì¡°ê±´ì€?"}, {"role": "assistant", "content": "í•™ìš°ë‹˜, ì·¨ì—…ìƒ(ê±´ê°•ë³´í—˜ ì§ì¥ê°€ì…ì)ì˜ ê²½ìš° ì¬ì§ì¦ëª…ì„œ ë“±ì„ ì œì¶œí•˜ë©´ ì™¸êµ­ì–´ ì˜ì—­ ëŒ€ì²´ ì¸ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤."}]},
    {"messages": [{"role": "system", "content": "ë‹¹ì‹ ì€ í•œêµ­í•´ì–‘ëŒ€ ì¬í•™ìƒ ë¹„ì„œ ARAì…ë‹ˆë‹¤."}, {"role": "user", "content": "í•´ì‚¬ëŒ€í•™ ì¡¸ì—…í•™ì  ì•Œë ¤ì¤˜."}, {"role": "assistant", "content": "í•™ìš°ë‹˜, í•´ì‚¬ëŒ€í•™ì€ ì´ 150í•™ì  ì´ìƒ ì´ìˆ˜í•´ì•¼ ì¡¸ì—…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤."}]},
    
    # (ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì— ë°ì´í„°ê°€ ë” ë§ì´ ë“¤ì–´ê°€ì•¼ ì„±ëŠ¥ì´ ì¢‹ì•„ì§‘ë‹ˆë‹¤. ì˜ˆì‹œìš© 6ê°œ)
]

# JSONL íŒŒì¼ë¡œ ì €ì¥
file_name = "ara_finetune_restored.jsonl"
with open(file_name, "w", encoding="utf-8") as f:
    for entry in training_data:
        f.write(json.dumps(entry, ensure_ascii=False) + "\n")

print(f"âœ… ë°ì´í„° ìƒì„± ì™„ë£Œ! ({file_name})")

# ==========================================
# 3. OpenAI ì„œë²„ë¡œ íŒŒì¼ ì—…ë¡œë“œ
# ==========================================
print("ğŸ“¤ [2/3] OpenAI ì„œë²„ë¡œ íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤...")

try:
    file_response = client.files.create(
        file=open(file_name, "rb"),
        purpose="fine-tune"
    )
    file_id = file_response.id
    print(f"âœ… ì—…ë¡œë“œ ì„±ê³µ! íŒŒì¼ ID: {file_id}")
    
    # ì—…ë¡œë“œ ì²˜ë¦¬ ëŒ€ê¸° (ì ì‹œ ê¸°ë‹¤ë¦¼)
    time.sleep(2)

    # ==========================================
    # 4. íŒŒì¸ íŠœë‹ ì‘ì—… ì‹œì‘ (Training)
    # ==========================================
    print("ğŸš€ [3/3] íŒŒì¸ íŠœë‹(Fine-tuning) ì‘ì—…ì„ ìš”ì²­í•©ë‹ˆë‹¤...")
    
    job_response = client.fine_tuning.jobs.create(
        training_file=file_id,
        model="gpt-3.5-turbo", # ê°€ì¥ ê°€ì„±ë¹„ ì¢‹ì€ ëª¨ë¸
        hyperparameters={"n_epochs": 3} # 3ë²ˆ ë°˜ë³µ í•™ìŠµ
    )
    
    job_id = job_response.id
    print("\n" + "="*40)
    print(f"ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! í•™ìŠµì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.")
    print(f"ğŸ”¹ Job ID: {job_id}")
    print(f"ğŸ”¹ ìƒíƒœ í™•ì¸: https://platform.openai.com/finetune")
    print("="*40)
    print("\n[ì°¸ê³ ] í•™ìŠµì´ ì™„ë£Œë˜ë©´ OpenAIì—ì„œ ì´ë©”ì¼ì´ ì˜µë‹ˆë‹¤.")
    print("ì™„ë£Œ í›„, ARA ì½”ë“œì˜ model='gpt-4o' ë¶€ë¶„ì„ model='ft:gpt-3.5-turbo:...' ë¡œ ë°”ê¿”ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.")

except Exception as e:
    print(f"\nâŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
    print("API í‚¤ê°€ ì˜¬ë°”ë¥¸ì§€, ë˜ëŠ” ê²°ì œ ì¹´ë“œê°€ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.")